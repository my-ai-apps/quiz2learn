
/*!
Copyright Â© 2024 Saisha Pandit. All Rights Reserved.
Unauthorized use, modification, or distribution is strictly prohibited.
*/
const _0x235424=_0x3b05;(function(_0x507d9a,_0x3bb4ad){const _0xc0d27d=_0x3b05,_0x177b77=_0x507d9a();while(!![]){try{const _0x39d4ba=parseInt(_0xc0d27d(0x1d6))/0x1*(-parseInt(_0xc0d27d(0x1e3))/0x2)+parseInt(_0xc0d27d(0x1cc))/0x3*(-parseInt(_0xc0d27d(0x1ff))/0x4)+parseInt(_0xc0d27d(0x1e4))/0x5+-parseInt(_0xc0d27d(0x1f8))/0x6*(-parseInt(_0xc0d27d(0x1e8))/0x7)+-parseInt(_0xc0d27d(0x202))/0x8+parseInt(_0xc0d27d(0x1fb))/0x9*(-parseInt(_0xc0d27d(0x213))/0xa)+-parseInt(_0xc0d27d(0x1f5))/0xb*(-parseInt(_0xc0d27d(0x1fe))/0xc);if(_0x39d4ba===_0x3bb4ad)break;else _0x177b77['push'](_0x177b77['shift']());}catch(_0x22c419){_0x177b77['push'](_0x177b77['shift']());}}}(_0x3305,0x7ddcc));import{Logger}from'./common.js';class Conversation{constructor(_0x2cded1,_0x4a7121){const _0x31f58a=_0x3b05,_0x565e16={'NpLtF':_0x31f58a(0x1c9)},_0x1e22cd=_0x565e16['NpLtF'][_0x31f58a(0x20b)]('|');let _0x55b727=0x0;while(!![]){switch(_0x1e22cd[_0x55b727++]){case'0':this[_0x31f58a(0x1ed)]=new Date()['toISOString']();continue;case'1':this[_0x31f58a(0x1f0)]=_0x4a7121;continue;case'2':this[_0x31f58a(0x20d)]=new Date()[_0x31f58a(0x1e6)]();continue;case'3':this['messages']=[];continue;case'4':this['id']=_0x2cded1;continue;}break;}}}class ChatManager{constructor(){const _0x12a8c7=_0x3b05,_0x53f64e={'gOiqq':_0x12a8c7(0x205),'NcPsp':function(_0x15e3b9,_0x39f382){return _0x15e3b9*_0x39f382;}},_0x1eedc5=_0x53f64e[_0x12a8c7(0x1db)][_0x12a8c7(0x20b)]('|');let _0x586caf=0x0;while(!![]){switch(_0x1eedc5[_0x586caf++]){case'0':this[_0x12a8c7(0x1d7)]=0x32;continue;case'1':this[_0x12a8c7(0x201)]=_0x53f64e[_0x12a8c7(0x1d4)](_0x53f64e['NcPsp'](4.5,0x400),0x400);continue;case'2':this['loadConversations']();continue;case'3':this['conversations']={};continue;case'4':this[_0x12a8c7(0x1d1)]={'onConversationUpdate':[],'onCurrentConversationChange':[],'onError':[]};continue;case'5':this['currentConversationId']=null;continue;}break;}}async[_0x235424(0x1d0)](){const _0x21bebb=_0x235424,_0x26eccd={'nwwuW':_0x21bebb(0x1fc),'CfZUd':function(_0x2a55ca,_0x421cb5){return _0x2a55ca>_0x421cb5;}};try{const _0x4c7000=localStorage['getItem'](_0x26eccd[_0x21bebb(0x1f9)]);if(_0x4c7000){const _0xd73c4c=JSON['parse'](_0x4c7000)||[];this['conversations']=_0xd73c4c[_0x21bebb(0x1c6)]((_0x6bab1a,_0x15d4eb)=>{const _0x8b2c85=_0x21bebb,_0x19d2e6=_0x8b2c85(0x1fa)[_0x8b2c85(0x20b)]('|');let _0x2e077b=0x0;while(!![]){switch(_0x19d2e6[_0x2e077b++]){case'0':_0x6bab1a[_0x15d4eb['id']][_0x8b2c85(0x20d)]=_0x15d4eb[_0x8b2c85(0x20d)];continue;case'1':_0x6bab1a[_0x15d4eb['id']]['messages']=_0x15d4eb[_0x8b2c85(0x1ea)]||[];continue;case'2':_0x6bab1a[_0x15d4eb['id']][_0x8b2c85(0x1ed)]=_0x15d4eb[_0x8b2c85(0x1ed)];continue;case'3':return _0x6bab1a;case'4':_0x6bab1a[_0x15d4eb['id']]=new Conversation(_0x15d4eb['id'],_0x15d4eb['title']);continue;}break;}},{}),_0x26eccd[_0x21bebb(0x1c5)](Object['keys'](this[_0x21bebb(0x1fc)])[_0x21bebb(0x1de)],0x0)&&(this['currentConversationId']=Object[_0x21bebb(0x1da)](this[_0x21bebb(0x1fc)])[0x0]),Logger['info'](_0x21bebb(0x1ee)+Object[_0x21bebb(0x1da)](this[_0x21bebb(0x1fc)])[_0x21bebb(0x1de)]+_0x21bebb(0x1dd));}}catch(_0x4647f1){const _0x40bdf7=Logger[_0x21bebb(0x203)](_0x21bebb(0x1df),_0x4647f1);this[_0x21bebb(0x1e5)](_0x40bdf7),this[_0x21bebb(0x1fc)]={};}}async['saveConversations'](){const _0x14bdea=_0x235424,_0x557b7a={'yINhO':_0x14bdea(0x20f),'LmZsP':'Failed\x20to\x20save\x20conversations'};try{const _0x1972b1=JSON[_0x14bdea(0x1f6)](Object['values'](this[_0x14bdea(0x1fc)]));_0x1972b1[_0x14bdea(0x1de)]>this['MAX_STORAGE_SIZE']&&await this[_0x14bdea(0x207)](),localStorage[_0x14bdea(0x1cd)]('conversations',_0x1972b1),this[_0x14bdea(0x1c8)](),Logger['info'](_0x557b7a[_0x14bdea(0x20e)]);}catch(_0x1e22ae){const _0x56f97f=Logger[_0x14bdea(0x203)](_0x557b7a[_0x14bdea(0x1ef)],_0x1e22ae);this[_0x14bdea(0x1e5)](_0x56f97f);}}async['cleanupStorage'](){const _0x3f838c=_0x235424,_0x68061a={'xzcnT':function(_0x140d6f,_0x5c00d1){return _0x140d6f>_0x5c00d1;},'xyMlO':function(_0xe77efe,_0x52b848){return _0xe77efe>_0x52b848;},'dtvjq':'Storage\x20cleanup\x20completed'};Logger[_0x3f838c(0x200)](_0x3f838c(0x1f3));const _0x380c97=this['getSortedConversations']();_0x68061a[_0x3f838c(0x1d5)](_0x380c97[_0x3f838c(0x1de)],this[_0x3f838c(0x1d7)])&&(this['conversations']=_0x380c97[_0x3f838c(0x1ca)](0x0,this['MAX_CONVERSATIONS'])[_0x3f838c(0x1c6)]((_0x34cc74,_0x4f2164)=>{return _0x34cc74[_0x4f2164['id']]=_0x4f2164,_0x34cc74;},{}),Logger[_0x3f838c(0x206)]('Trimmed\x20to\x20'+this[_0x3f838c(0x1d7)]+'\x20most\x20recent\x20conversations'));let _0x33f6d7=JSON['stringify'](Object['values'](this[_0x3f838c(0x1fc)]))[_0x3f838c(0x1de)];while(_0x68061a[_0x3f838c(0x1e9)](_0x33f6d7,this[_0x3f838c(0x201)])&&_0x68061a[_0x3f838c(0x1d5)](Object[_0x3f838c(0x1da)](this[_0x3f838c(0x1fc)])[_0x3f838c(0x1de)],0x0)){const _0x7e645d=_0x380c97[_0x3f838c(0x1d8)]();_0x68061a[_0x3f838c(0x1e9)](_0x7e645d[_0x3f838c(0x1ea)][_0x3f838c(0x1de)],0xa)?_0x7e645d['messages']=_0x7e645d[_0x3f838c(0x1ea)]['slice'](-0xa):delete this['conversations'][_0x7e645d['id']],_0x33f6d7=JSON[_0x3f838c(0x1f6)](Object[_0x3f838c(0x1e1)](this[_0x3f838c(0x1fc)]))[_0x3f838c(0x1de)];}Logger[_0x3f838c(0x206)](_0x68061a[_0x3f838c(0x1f1)]);}async[_0x235424(0x212)](_0x1545d6=_0x235424(0x1e0)){const _0x4523c5=_0x235424,_0x581cfc=_0x4523c5(0x1f7)+Date[_0x4523c5(0x1fd)](),_0x59cca7=new Conversation(_0x581cfc,_0x1545d6);return this[_0x4523c5(0x1fc)][_0x581cfc]=_0x59cca7,this['currentConversationId']=_0x581cfc,await this['saveConversations'](),this[_0x4523c5(0x1e7)](),_0x581cfc;}['getCurrentConversation'](){const _0x1e8cc5=_0x235424;return this[_0x1e8cc5(0x1fc)][this[_0x1e8cc5(0x20c)]]||null;}async[_0x235424(0x20a)](_0x27976f,_0x59e9c4){const _0x4f0a29=_0x235424,_0x48f4f1={'kVlZH':_0x4f0a29(0x1d2),'dDLbE':function(_0x3d2a5a,_0x31c7ae){return _0x3d2a5a===_0x31c7ae;},'yjdnZ':_0x4f0a29(0x1e0),'irXXf':function(_0x4eb261,_0x4b4fc9){return _0x4eb261===_0x4b4fc9;},'nzZuW':function(_0x45712a,_0x2f5d89){return _0x45712a+_0x2f5d89;},'DOsSb':_0x4f0a29(0x1e2)},_0x2e566c=this[_0x4f0a29(0x1f4)]();if(!_0x2e566c)return![];const _0x21074d={'role':_0x59e9c4,'content':_0x27976f,'timestamp':new Date()[_0x4f0a29(0x1e6)]()};return _0x2e566c[_0x4f0a29(0x1ea)][_0x4f0a29(0x214)](_0x21074d),_0x2e566c[_0x4f0a29(0x1ed)]=new Date()[_0x4f0a29(0x1e6)](),_0x59e9c4===_0x48f4f1[_0x4f0a29(0x211)]&&_0x48f4f1[_0x4f0a29(0x208)](_0x2e566c[_0x4f0a29(0x1f0)],_0x48f4f1[_0x4f0a29(0x1cf)])&&_0x48f4f1['irXXf'](_0x2e566c[_0x4f0a29(0x1ea)][_0x4f0a29(0x1de)],0x1)&&(_0x2e566c['title']=_0x48f4f1[_0x4f0a29(0x1cb)](_0x27976f[_0x4f0a29(0x20b)]('\x20')['slice'](0x0,0x4)['join']('\x20'),_0x48f4f1[_0x4f0a29(0x210)])),await this[_0x4f0a29(0x1f2)](),!![];}async['deleteConversation'](_0x22649c){const _0x5db77f=_0x235424;this[_0x5db77f(0x1fc)][_0x22649c]&&(delete this[_0x5db77f(0x1fc)][_0x22649c],this[_0x5db77f(0x20c)]===_0x22649c&&(this[_0x5db77f(0x20c)]=Object['keys'](this[_0x5db77f(0x1fc)])[0x0]||null),await this[_0x5db77f(0x1f2)]());}[_0x235424(0x1eb)](_0x391d43){const _0x3e1566=_0x235424;if(this[_0x3e1566(0x1fc)][_0x391d43])return this[_0x3e1566(0x20c)]=_0x391d43,this[_0x3e1566(0x1e7)](),!![];return![];}[_0x235424(0x1d3)](){const _0x583b74=_0x235424;return Object[_0x583b74(0x1e1)](this[_0x583b74(0x1fc)])[_0x583b74(0x204)]((_0x6e22c,_0x5c87ac)=>new Date(_0x5c87ac['updatedAt'])-new Date(_0x6e22c[_0x583b74(0x1ed)]));}['notifyConversationUpdate'](){const _0x5d04ce=_0x235424;this[_0x5d04ce(0x1d1)][_0x5d04ce(0x209)][_0x5d04ce(0x1d9)](_0xf34b12=>_0xf34b12(Object[_0x5d04ce(0x1e1)](this[_0x5d04ce(0x1fc)])));}[_0x235424(0x1e7)](){const _0x5f5939=_0x235424;this[_0x5f5939(0x1d1)]['onCurrentConversationChange'][_0x5f5939(0x1d9)](_0x518bd7=>_0x518bd7(this[_0x5f5939(0x1f4)]()));}['notifyError'](_0xc48542){const _0x54cea1=_0x235424;this[_0x54cea1(0x1d1)][_0x54cea1(0x1ec)]['forEach'](_0x5c78a9=>_0x5c78a9(_0xc48542));}[_0x235424(0x1dc)](_0xce3e9d,_0x5b3209){const _0x576a6a=_0x235424;this[_0x576a6a(0x1d1)][_0xce3e9d]&&this['listeners'][_0xce3e9d][_0x576a6a(0x214)](_0x5b3209);}[_0x235424(0x1ce)](_0x334383,_0x1188b7){const _0x3f157c=_0x235424;this['listeners'][_0x334383]&&(this[_0x3f157c(0x1d1)][_0x334383]=this[_0x3f157c(0x1d1)][_0x334383][_0x3f157c(0x1c7)](_0x4a8604=>_0x4a8604!==_0x1188b7));}}export{ChatManager};function _0x3b05(_0x420af4,_0x226963){const _0x330532=_0x3305();return _0x3b05=function(_0x3b050d,_0x4b6d82){_0x3b050d=_0x3b050d-0x1c5;let _0x49cf17=_0x330532[_0x3b050d];return _0x49cf17;},_0x3b05(_0x420af4,_0x226963);}function _0x3305(){const _0x2cb11b=['3|5|4|1|0|2','info','cleanupStorage','dDLbE','onConversationUpdate','addMessage','split','currentConversationId','createdAt','yINhO','Conversations\x20saved\x20successfully','DOsSb','kVlZH','createNewConversation','5095910LwgzOG','push','CfZUd','reduce','filter','notifyConversationUpdate','4|1|3|2|0','slice','nzZuW','3129ynZiqj','setItem','removeEventListener','yjdnZ','loadConversations','listeners','user','getSortedConversations','NcPsp','xzcnT','872472BldoyB','MAX_CONVERSATIONS','pop','forEach','keys','gOiqq','addEventListener','\x20conversations','length','Failed\x20to\x20load\x20conversations','New\x20Conversation','values','...','2zYXgSl','2092690dLRGVc','notifyError','toISOString','notifyCurrentConversationChange','23576KRMhmH','xyMlO','messages','switchConversation','onError','updatedAt','Loaded\x20','LmZsP','title','dtvjq','saveConversations','Storage\x20cleanup\x20initiated','getCurrentConversation','15814425hfbxSv','stringify','conv_','390GivIbo','nwwuW','4|1|0|2|3','9RNJXmG','conversations','now','12tyCAhw','44FmORyR','warn','MAX_STORAGE_SIZE','1328520ftADpw','error','sort'];_0x3305=function(){return _0x2cb11b;};return _0x3305();}