
/*!
Copyright Â© 2024 Saisha Pandit. All Rights Reserved.
Unauthorized use, modification, or distribution is strictly prohibited.
*/
const _0x1d6d9e=_0x4b5a;(function(_0x48710c,_0x50a6d3){const _0x5b3b53=_0x4b5a,_0x4e1a11=_0x48710c();while(!![]){try{const _0x3f5e04=-parseInt(_0x5b3b53(0x1f1))/0x1*(-parseInt(_0x5b3b53(0x1b9))/0x2)+parseInt(_0x5b3b53(0x1b0))/0x3*(-parseInt(_0x5b3b53(0x1b6))/0x4)+-parseInt(_0x5b3b53(0x1bf))/0x5*(-parseInt(_0x5b3b53(0x1ca))/0x6)+-parseInt(_0x5b3b53(0x1ea))/0x7*(-parseInt(_0x5b3b53(0x1dc))/0x8)+parseInt(_0x5b3b53(0x1e8))/0x9+parseInt(_0x5b3b53(0x1e7))/0xa+-parseInt(_0x5b3b53(0x1f8))/0xb*(parseInt(_0x5b3b53(0x1d4))/0xc);if(_0x3f5e04===_0x50a6d3)break;else _0x4e1a11['push'](_0x4e1a11['shift']());}catch(_0x136fd9){_0x4e1a11['push'](_0x4e1a11['shift']());}}}(_0x4108,0x89732));function _0x4108(){const _0x29cd7e=['conversations','Failed\x20to\x20save\x20conversations','now','createNewConversation','6FFrSWo','getCurrentConversation','MAX_CONVERSATIONS','notifyConversationUpdate','currentConversationId','UnScl','user','filter','setItem','loadConversations','295476MndFGc','keys','stringify','slice','sort','tXwLI','error','saveConversations','200iRgsbX','forEach','createdAt','ztnaz','TEveH','deleteConversation','cleanupStorage','CbPVu','QyJSG','ymLoB','Nveic','9460480ZWvaTO','2073078oFQhWs','warn','268058BmfqPT','toISOString','cCAWY','getItem','pop','split','info','2KWEILy','ElrNR','Storage\x20cleanup\x20completed','GubuP','mAlUU','values','updatedAt','1265kDBzjh','messages','198clMqwm','Loaded\x20','switchConversation','\x20conversations','3|4|1|0|2|5','map','42236tJaXBK','Failed\x20to\x20load\x20conversations','VsBQl','1031090MQzMCx','title','notifyCurrentConversationChange','MAX_STORAGE_SIZE','listeners','toString','4633515NqhtfT','Storage\x20cleanup\x20initiated','length','New\x20Chat','parse','Trimmed\x20to\x20','onCurrentConversationChange'];_0x4108=function(){return _0x29cd7e;};return _0x4108();}import{Logger}from'./common.js';function _0x4b5a(_0x28f0ff,_0x12397e){const _0x410801=_0x4108();return _0x4b5a=function(_0x4b5aa2,_0x2af208){_0x4b5aa2=_0x4b5aa2-0x1b0;let _0x3e0b3f=_0x410801[_0x4b5aa2];return _0x3e0b3f;},_0x4b5a(_0x28f0ff,_0x12397e);}class Conversation{constructor(_0xd9f072,_0x577e7d){const _0x3baad6=_0x4b5a,_0x35b192={'XXrhg':'2|1|3|0|4','ztnaz':function(_0x4c3cbf,_0x7f1db2){return _0x4c3cbf||_0x7f1db2;},'Nveic':_0x3baad6(0x1c2)},_0x41f02f=_0x35b192['XXrhg'][_0x3baad6(0x1ef)]('|');let _0x1b4a16=0x0;while(!![]){switch(_0x41f02f[_0x1b4a16++]){case'0':this[_0x3baad6(0x1de)]=new Date()['toISOString']();continue;case'1':this[_0x3baad6(0x1ba)]=_0x35b192[_0x3baad6(0x1df)](_0x577e7d,_0x35b192[_0x3baad6(0x1e6)]);continue;case'2':this['id']=_0xd9f072;continue;case'3':this[_0x3baad6(0x1f9)]=[];continue;case'4':this[_0x3baad6(0x1f7)]=new Date()[_0x3baad6(0x1eb)]();continue;}break;}}}class BaseConversationManager{constructor(){const _0x3d0141=_0x4b5a,_0x2e4f54={'VsBQl':_0x3d0141(0x1b4),'CbPVu':function(_0x316ca6,_0x1e0f2f){return _0x316ca6*_0x1e0f2f;}},_0x3e31b2=_0x2e4f54[_0x3d0141(0x1b8)][_0x3d0141(0x1ef)]('|');let _0x53e504=0x0;while(!![]){switch(_0x3e31b2[_0x53e504++]){case'0':this[_0x3d0141(0x1bc)]=_0x2e4f54['CbPVu'](_0x2e4f54[_0x3d0141(0x1e3)](4.5,0x400),0x400);continue;case'1':this['listeners']={'onConversationUpdate':[],'onCurrentConversationChange':[],'onError':[]};continue;case'2':this[_0x3d0141(0x1cc)]=0x32;continue;case'3':this[_0x3d0141(0x1c6)]={};continue;case'4':this[_0x3d0141(0x1ce)]=null;continue;case'5':this['loadConversations']();continue;}break;}}[_0x1d6d9e(0x1d3)](){const _0x2d0dd8=_0x1d6d9e,_0x1aacae={'ofilw':'conversations','ElrNR':_0x2d0dd8(0x1b7)};try{const _0x27a95f=JSON[_0x2d0dd8(0x1c3)](localStorage[_0x2d0dd8(0x1ed)](_0x1aacae['ofilw']))||[];Array['isArray'](_0x27a95f)&&(this[_0x2d0dd8(0x1c6)]=Object['fromEntries'](_0x27a95f[_0x2d0dd8(0x1b5)](_0xff7cc2=>[_0xff7cc2['id'],new Conversation(_0xff7cc2['id'],_0xff7cc2['title'])]))),Logger['info'](_0x2d0dd8(0x1b1)+Object[_0x2d0dd8(0x1d5)](this[_0x2d0dd8(0x1c6)])[_0x2d0dd8(0x1c1)]+_0x2d0dd8(0x1b3));}catch(_0x4d9e53){Logger['error'](_0x1aacae[_0x2d0dd8(0x1f2)],_0x4d9e53),this[_0x2d0dd8(0x1c6)]={};}}['saveConversations'](){const _0x2ceac2=_0x1d6d9e,_0x292891={'ymLoB':function(_0x5bd0c0,_0x492d0b){return _0x5bd0c0>_0x492d0b;},'cCAWY':_0x2ceac2(0x1c6),'UnScl':'Conversations\x20saved\x20successfully'};try{let _0x3398de=JSON[_0x2ceac2(0x1d6)](Object[_0x2ceac2(0x1f6)](this[_0x2ceac2(0x1c6)]));_0x292891[_0x2ceac2(0x1e5)](_0x3398de['length'],this['MAX_STORAGE_SIZE'])&&this[_0x2ceac2(0x1e2)](),localStorage[_0x2ceac2(0x1d2)](_0x292891[_0x2ceac2(0x1ec)],_0x3398de),this[_0x2ceac2(0x1cd)](),Logger[_0x2ceac2(0x1f0)](_0x292891[_0x2ceac2(0x1cf)]);}catch(_0x48bf76){Logger[_0x2ceac2(0x1da)](_0x2ceac2(0x1c7),_0x48bf76);}}['cleanupStorage'](){const _0x123f58=_0x1d6d9e,_0x36fd9c={'sPwjc':_0x123f58(0x1c0),'GubuP':function(_0x5802df,_0x5a8960){return _0x5802df>_0x5a8960;},'mAlUU':_0x123f58(0x1f3)};Logger[_0x123f58(0x1e9)](_0x36fd9c['sPwjc']);let _0x58e3e1=Object[_0x123f58(0x1f6)](this['conversations'])[_0x123f58(0x1d8)]((_0x14eaba,_0x4f8fe0)=>new Date(_0x4f8fe0[_0x123f58(0x1f7)])-new Date(_0x14eaba['updatedAt']));_0x58e3e1['length']>this[_0x123f58(0x1cc)]&&(_0x58e3e1=_0x58e3e1[_0x123f58(0x1d7)](0x0,this[_0x123f58(0x1cc)]),this[_0x123f58(0x1c6)]=Object['fromEntries'](_0x58e3e1[_0x123f58(0x1b5)](_0x1736ae=>[_0x1736ae['id'],_0x1736ae])),Logger[_0x123f58(0x1f0)](_0x123f58(0x1c4)+this[_0x123f58(0x1cc)]+_0x123f58(0x1b3)));let _0x55271b=JSON['stringify'](_0x58e3e1)[_0x123f58(0x1c1)];while(_0x36fd9c[_0x123f58(0x1f4)](_0x55271b,this[_0x123f58(0x1bc)])&&_0x36fd9c['GubuP'](_0x58e3e1['length'],0x0)){const _0x237c7c=_0x58e3e1[_0x123f58(0x1ee)]();delete this[_0x123f58(0x1c6)][_0x237c7c['id']],_0x55271b=JSON[_0x123f58(0x1d6)](Object[_0x123f58(0x1f6)](this[_0x123f58(0x1c6)]))[_0x123f58(0x1c1)];}Logger[_0x123f58(0x1f0)](_0x36fd9c[_0x123f58(0x1f5)]);}[_0x1d6d9e(0x1c9)](_0x238e9c=_0x1d6d9e(0x1c2)){const _0x237388=_0x1d6d9e,_0x54b319=Date[_0x237388(0x1c8)]()[_0x237388(0x1be)]();return this[_0x237388(0x1c6)][_0x54b319]=new Conversation(_0x54b319,_0x238e9c),this[_0x237388(0x1ce)]=_0x54b319,this[_0x237388(0x1db)](),this[_0x237388(0x1bb)](),_0x54b319;}[_0x1d6d9e(0x1e1)](_0x4fd65){const _0x555638=_0x1d6d9e,_0x2c3871={'tXwLI':function(_0x2d9af7,_0x19a613){return _0x2d9af7===_0x19a613;}};this[_0x555638(0x1c6)][_0x4fd65]&&(delete this[_0x555638(0x1c6)][_0x4fd65],_0x2c3871[_0x555638(0x1d9)](this['currentConversationId'],_0x4fd65)&&(this[_0x555638(0x1ce)]=null,this[_0x555638(0x1c9)]()),this[_0x555638(0x1db)]());}[_0x1d6d9e(0x1b2)](_0x3dc74b){const _0x5bfb2c=_0x1d6d9e;if(this[_0x5bfb2c(0x1c6)][_0x3dc74b])return this['currentConversationId']=_0x3dc74b,this[_0x5bfb2c(0x1bb)](),!![];return![];}['getCurrentConversation'](){const _0xe1e5b2=_0x1d6d9e;return this[_0xe1e5b2(0x1c6)][this['currentConversationId']]||null;}['addMessage'](_0x121e17,_0x155f4b){const _0x1883e1=_0x1d6d9e,_0x241f3f={'DQIpd':_0x1883e1(0x1d0),'QyJSG':function(_0x3b487e,_0x445337){return _0x3b487e===_0x445337;},'TEveH':function(_0x45948d,_0x150ff8){return _0x45948d>_0x150ff8;},'sLbJA':'...'},_0x23936c=this['getCurrentConversation']();if(!_0x23936c)return![];return _0x23936c[_0x1883e1(0x1f9)]['push']({'role':_0x155f4b,'content':_0x121e17,'timestamp':new Date()[_0x1883e1(0x1eb)]()}),_0x23936c[_0x1883e1(0x1f7)]=new Date()['toISOString'](),_0x155f4b===_0x241f3f['DQIpd']&&_0x241f3f[_0x1883e1(0x1e4)](_0x23936c[_0x1883e1(0x1f9)][_0x1883e1(0x1c1)],0x1)&&(_0x23936c['title']=_0x121e17[_0x1883e1(0x1d7)](0x0,0x1e)+(_0x241f3f[_0x1883e1(0x1e0)](_0x121e17[_0x1883e1(0x1c1)],0x1e)?_0x241f3f['sLbJA']:'')),this[_0x1883e1(0x1db)](),!![];}['notifyConversationUpdate'](){const _0x3d3727=_0x1d6d9e;this[_0x3d3727(0x1bd)]['onConversationUpdate'][_0x3d3727(0x1dd)](_0x5f511e=>_0x5f511e(this[_0x3d3727(0x1c6)]));}['notifyCurrentConversationChange'](){const _0x4f4fc=_0x1d6d9e;this['listeners'][_0x4f4fc(0x1c5)][_0x4f4fc(0x1dd)](_0x108b61=>_0x108b61(this[_0x4f4fc(0x1cb)]()));}['addEventListener'](_0x19afe5,_0x206f78){const _0x23f802=_0x1d6d9e;this[_0x23f802(0x1bd)][_0x19afe5]&&this[_0x23f802(0x1bd)][_0x19afe5]['push'](_0x206f78);}['removeEventListener'](_0x4e8d9e,_0x52ddd3){const _0x1e7fec=_0x1d6d9e;this[_0x1e7fec(0x1bd)][_0x4e8d9e]&&(this[_0x1e7fec(0x1bd)][_0x4e8d9e]=this['listeners'][_0x4e8d9e][_0x1e7fec(0x1d1)](_0x4dcea4=>_0x4dcea4!==_0x52ddd3));}}export{BaseConversationManager};